## 2. 常用性能指标介绍

最火热的JVM知识是什么?  很多同学的答案可能是 “JVM调优” 或者 “JVM性能优化”。

> 没有量化就没有改进，所以我们需要先了解和度量性能指标。

JVM调优要做些什么呢?

1. 排查程序运行中出现的问题： 排查程序BUG: 程序问题必须是优先解决的，要保证正确性。例如死锁等等, 当然，JVM层面的排查只是辅助手段，更多的还是分析业务代码和逻辑确定Java程序哪里有问题。
2. 分析系统性能问题: 比如借助监控和日志，判断资源层面有没有问题? JVM层面有没有问题?
3. 监控并得出关键性能指标数据
3. 根据分析结果和性能指标，进行资源配置调整，并持续进行监控和分析，以优化性能，直到满足系统要求。


计算机系统中,性能相关的资源主要分为这几类:

- CPU
- 内存
- IO: 存储+网络


性能优化中常见的套路：

一般先排查基础资源是否成为瓶颈。看资源够不够，只要成本允许，加配置可能是最快速的解决方案，还可能是最划算，最有效的解决方案。

与JVM有关的系统资源，主要是 `CPU` 和 `内存` 这两部分。 如果发生资源告警/不足, 就需要评估系统容量，分析原因。

> 至于 GPU 、主板、芯片组之类的资源则不太好衡量，通用计算系统很少涉及。


一般衡量系统性能的维度有3个:

- 延迟(Latency)： 一般衡量的是响应时间(Response Time)，比如95线，99线，最大响应时间等。
- 吞吐量(Throughput)： 一般的衡量每秒处理的事务数(TPS)。
- 系统容量(Capacity)： 也叫做设计容量，可以理解为硬件配置，成本约束。

这3个维度互相关联，相互制约。只要系统架构允许，增加硬件配置一般都能提升性能指标。


性能指标还可分为两类:

- **业务需求指标**：如吞吐量(QPS、TPS)、响应时间(RT)、并发数、业务成功率等。
- **资源约束指标**：如CPU、内存、I/O等资源的消耗情况。

> 详情可参考: [性能测试中服务器关键性能指标浅析](https://www.jianshu.com/p/62cf2690e6eb)


每类系统关注的重点还不一样。 批处理/流处理 系统更关注吞吐量, 延迟可以适当放宽。一般来说大部分系统的硬件资源不会太差，但也不是无限的。高可用Web系统，既关注高并发情况下的系统响应时间，也关注吞吐量。


> **例如**： "配置2核4GB的节点，每秒响应200个请求，95%线是20ms，最大响应时间40ms。"
> 从中可以解读出基本的性能信息: 响应时间(RS<40ms), 吞吐量(200TPS), 系统配置信息(2C4G)。
> 隐含的条件可能是 "并发请求数不超过200 "。



我们可采用的手段和方式包括:

- 本地/远程调试, 下文将简单介绍JDWP与远程调试
- 状态监控
- 性能分析: CPU使用情况/内存分配分析
- 内存分析: Dump分析/GC日志分析
- 调整JVM启动参数
